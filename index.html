<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Najlepsze pla≈ºe Teneryfy ‚Äî interaktywna mapa</title>
  <!-- Prostsze i bardziej odporne ≈Çadowanie Leaflet: statyczne <link>/<script> + runtime fallback -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin="anonymous" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin="anonymous" defer></script>

  <style>
    html, body { height: 100%; margin: 0; }
    #map { height: 100vh; width: 100vw; }
    .legend { position: fixed; bottom: 20px; left: 20px; z-index: 9999; background: white; border: 1px solid #bbb; border-radius: 8px; padding: 10px 12px; font: 14px/1.4 system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
    .legend .row { display: flex; align-items: center; gap: 8px; margin: 4px 0; }
    .popup img { width: 100%; height: auto; border-radius: 8px; display: block; margin: 6px 0 8px; }
    .popup h4 { margin: 0 0 6px; font-size: 16px; }
    .popup p { margin: 4px 0; font-size: 13px; }
    .popup ul { margin: 0 0 8px 18px; padding: 0; font-size: 13px; }
    .btns { display: flex; gap: 8px; flex-wrap: wrap; }
    .btns a { text-decoration: none; padding: 6px 10px; border-radius: 6px; border: 1px solid #1a73e8; font-size: 13px; }
    .btns a.commons { border-color: #0f766e; }
    .error-hint { position:fixed;top:12px;left:12px;background:#fee;border:1px solid #fbb;border-radius:8px;padding:10px 12px;z-index:99999;font:14px system-ui }
  </style>
</head>
<body>
  <div id="map" role="region" aria-label="Mapa najlepszych pla≈º Teneryfy"></div>
  <div class="legend" aria-live="polite">
    <div><b>Legenda</b></div>
    <div class="row">üîµ Top pla≈ºe (klasyki)</div>
    <div class="row">üü¢ Sekretne/ukryte pla≈ºe</div>
    <div style="font-size:12px;color:#555;">Kliknij zdjƒôcie, aby otworzyƒá stronƒô pliku na Wikimedia Commons.</div>
  </div>

  <script>
  (async function bootstrap() {
    // 1) Je≈ºeli z jakiego≈õ powodu Leaflet siƒô nie za≈Çadowa≈Ç z unpkg, do≈Çaduj z fallback√≥w
    function loadScript(src){return new Promise((res,rej)=>{const s=document.createElement('script');s.src=src;s.defer=true;s.onload=res;s.onerror=()=>rej(new Error('Nie uda≈Ço siƒô za≈Çadowaƒá '+src));document.head.appendChild(s);});}
    function loadCss(href){return new Promise((res)=>{const l=document.createElement('link');l.rel='stylesheet';l.href=href;l.onload=res;l.onerror=res;document.head.appendChild(l);});}

    if(!window.L){
      await loadCss('https://cdn.jsdelivr.net/npm/leaflet@1.9.4/dist/leaflet.css');
      try { await loadScript('https://cdn.jsdelivr.net/npm/leaflet@1.9.4/dist/leaflet.js'); } catch(e){
        await loadCss('https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.css');
        await loadScript('https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.js');
      }
    }

    if(!window.L){
      const hint=document.createElement('div');
      hint.className='error-hint';
      hint.innerHTML='<b>Nie uda≈Ço siƒô za≈Çadowaƒá Leaflet.</b><br>Od≈õwie≈º stronƒô lub sprawd≈∫ blokady sieci/CDN.';
      document.body.appendChild(hint);
      return;
    }

    try {
      // 2) Inicjalizacja mapy
      const map = L.map('map', { zoomControl: true }).setView([28.30, -16.60], 10);
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { maxZoom: 19, attribution: '&copy; OpenStreetMap' }).addTo(map);

      // 3) Ikony marker√≥w (bez AwesomeMarkers, 100% kompatybilne):
      const BlueIcon = new L.Icon({
        iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-blue.png',
        shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-shadow.png',
        iconSize: [25, 41], iconAnchor: [12, 41], popupAnchor: [1, -34], shadowSize: [41, 41]
      });
      const GreenIcon = new L.Icon({
        iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-green.png',
        shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-shadow.png',
        iconSize: [25, 41], iconAnchor: [12, 41], popupAnchor: [1, -34], shadowSize: [41, 41]
      });

      // 4) Dane pla≈º
      const TOP_BEACHES = [
        { name: 'Playa de Las Teresitas', coords: [28.5079, -16.1870], img: 'https://upload.wikimedia.org/wikipedia/commons/1/1e/Playa_de_Las_Teresitas_2015.jpg', commons: 'Playa_de_Las_Teresitas_2015.jpg', access: 'Dojazd ≈Çatwy, 10‚Äì15 min od Santa Cruz. Autobus TITSA 910 (San Andr√©s).', parking: 'Du≈ºy, bezp≈Çatny parking wzd≈Çu≈º pla≈ºy; w weekendy t≈Çoczno.', tips: ['Zwykle sƒÖ ratownicy i prysznice.', 'Ma≈Ço cienia ‚Äì we≈∫ parasol/krem SPF.', 'Falochrony = spokojna woda dla rodzin.', 'W weekendy przyjed≈∫ wcze≈õnie (miejsca siƒô zape≈ÇniajƒÖ).'] },
        { name: 'Playa de la Tejita', coords: [28.0405, -16.5415], img: 'https://upload.wikimedia.org/wikipedia/commons/7/77/La_Tejita_beach_-_Montana_Roja_2.jpg', commons: 'La_Tejita_beach_-_Montana_Roja_2.jpg', access: 'Kr√≥tkie doj≈õcie z El M√©dano/Monta≈Ña Roja (5‚Äì10 min).', parking: 'Nieutwardzone place, bywa piaszczy≈õcie i wietrznie.', tips: ['Silny wiatr ‚Äì ≈õwietna na kite/surf, mniej dla ma≈Çych dzieci.', 'Brak sta≈Çego cienia i ograniczona infrastruktura.', 'Strefy naturystyczne bli≈ºej Monta√±a Roja.', 'Uwaga na py≈Ç/piasek przy mocnym wietrze.'] },
        { name: 'Playa de Benijo', coords: [28.5767, -16.1863], img: 'https://upload.wikimedia.org/wikipedia/commons/8/84/Benijo_Beach%2C_Tenerife%2C_Spain.jpg', commons: 'Benijo_Beach,_Tenerife,_Spain.jpg', access: 'Zjazd TF‚Äë134, zej≈õcie stromƒÖ ≈õcie≈ºkƒÖ/schodami.', parking: 'Niewiele miejsc przy drodze/restauracjach ‚Äì przyjed≈∫ wcze≈õnie.', tips: ['Brak falochron√≥w i silny przyb√≥j ‚Äì nie dla poczƒÖtkujƒÖcych p≈Çywak√≥w.', 'Sprawd≈∫ p≈Çywy ‚Äì przy wysokiej wodzie pla≈ºa znika.', 'Najlepsze ≈õwiat≈Ço na zdjƒôcia: zach√≥d s≈Ço≈Ñca.', 'We≈∫ wodƒô i przekƒÖski ‚Äì ma≈Ço us≈Çug na samej pla≈ºy.'] },
        { name: 'Playa de los Gu√≠os (Los Gigantes)', coords: [28.2422, -16.8412], img: 'https://upload.wikimedia.org/wikipedia/commons/0/0a/Playa_de_los_Gu%C3%ADos%2C_Los_Gigantes%2C_Tenerife.jpg', commons: 'Playa_de_los_Gu√≠os,_Los_Gigantes,_Tenerife.jpg', access: 'W centrum miasteczka, kilka minut od mariny.', parking: 'Parkingi p≈Çatne/uliczne; ma≈Ço miejsc w sezonie.', tips: ['Miejsce szybko zanika przy przyp≈Çywie ‚Äì przyjd≈∫ rano.', 'Os≈Çoniƒôta zatoka, ale prƒÖd mo≈ºe byƒá odczuwalny.', 'Sklepy i bary w zasiƒôgu kr√≥tkiego spaceru.', 'Dobre miejsce na rejsy pod klifami.'] }
      ];

      const SECRET_BEACHES = [
        { name: 'Playa de Antequera', coords: [28.5655, -16.1350], img: 'https://upload.wikimedia.org/wikipedia/commons/5/5a/Playa_de_Antequera_Tenerife.jpg', commons: 'Playa_de_Antequera_Tenerife.jpg', access: 'Trekking z Anaga (d≈Çugi, wymagajƒÖcy, ekspozycja) lub ≈Ç√≥d≈∫ z San Andr√©s (zale≈ºnie od morza).', parking: 'Parkuj w San Andr√©s (≈Ç√≥d≈∫) lub na poczƒÖtku szlaku (miejsca ograniczone).', tips: ['Sprawd≈∫ p≈Çywy i prognozƒô fal ‚Äì odp≈Çyw daje wiƒôcej pla≈ºy.', 'Brak ratownik√≥w i infrastruktury ‚Äì dziko.', 'Buty trekkingowe i zapas wody obowiƒÖzkowo.', 'S≈Ço≈Ñce szybko ‚Äûpra≈ºy‚Äù ‚Äì kapelusz/parasolka mile widziane.'] },
        { name: 'Playa Diego Hern√°ndez (La Caleta)', coords: [28.1098, -16.7595], img: 'https://upload.wikimedia.org/wikipedia/commons/6/68/Playa_Diego_Hernandez_Tenerife.jpg', commons: 'Playa_Diego_Hernandez_Tenerife.jpg', access: '≈öcie≈ºka z La Caleta ok. 15‚Äì20 min; miejscami skarpa/kamienie.', parking: 'Uliczne miejsca w La Caleta; w weekendy brak szybko.', tips: ['Bywa tymczasowo zamykana przy du≈ºym zafalowaniu/pracach ‚Äì sprawd≈∫ na miejscu.', 'Brak udogodnie≈Ñ; we≈∫ wodƒô i worek na ≈õmieci.', 'Pod stopami kamienie ‚Äì przydadzƒÖ siƒô buty do wody.', 'Zachowaj ostro≈ºno≈õƒá przy przyp≈Çywie (mniej piasku).'] },
        { name: 'Playa de Abama', coords: [28.1408, -16.8072], img: 'https://upload.wikimedia.org/wikipedia/commons/2/2d/Playa_de_Abama%2C_Tenerife.jpg', commons: 'Playa_de_Abama,_Tenerife.jpg', access: 'Przez kompleks Abama; zej≈õcie ≈õcie≈ºkƒÖ lub winda (nie zawsze dzia≈Ça).', parking: 'Miejsca wzd≈Çu≈º drogi do hotelu i zatoczki; szybko siƒô zape≈ÇniajƒÖ.', tips: ['Os≈Çoniƒôta zatoka ‚Äì dobra dla dzieci.', 'W sezonie t≈Çoczno; przyjd≈∫ wcze≈õniej.', 'Mo≈ºliwe fale przy wietrze z po≈Çudnia ‚Äì miej oko na dzieci.', 'Kawiarnia i toalety zwykle dostƒôpne wy≈ºej przy windzie.'] }
      ];

      function gmapsLink([lat, lon]) { return `https://www.google.com/maps/search/?api=1&query=${lat},${lon}`; }
      function commonsPage(fileName) { return `https://commons.wikimedia.org/wiki/File:${encodeURIComponent(fileName)}`; }
      function buildPopupHTML(b) {
        const tips = (b.tips || []).map(t => `<li>${t}</li>`).join('');
        return `
          <div class="popup" style="width:320px;">
            <h4>${b.name}</h4>
            <a href="${commonsPage(b.commons)}" target="_blank" rel="noopener">
              <img src="${b.img}" alt="${b.name}" referrerpolicy="no-referrer" loading="eager">
            </a>
            <p><b>Dojazd / doj≈õcie:</b> ${b.access}</p>
            <p><b>Parking:</b> ${b.parking}</p>
            <p><b>Wa≈ºne wskaz√≥wki:</b></p>
            <ul>${tips}</ul>
            <div class="btns">
              <a class="commons" href="${commonsPage(b.commons)}" target="_blank" rel="noopener">Strona zdjƒôcia (Wikimedia)</a>
              <a href="${gmapsLink(b.coords)}" target="_blank" rel="noopener">Nawiguj w Google Maps</a>
            </div>
          </div>`;
      }

      const topLayer = L.layerGroup();
      const secretLayer = L.layerGroup();

      TOP_BEACHES.forEach(b => L.marker(b.coords, { icon: BlueIcon }).bindPopup(buildPopupHTML(b)).addTo(topLayer));
      SECRET_BEACHES.forEach(b => L.marker(b.coords, { icon: GreenIcon }).bindPopup(buildPopupHTML(b)).addTo(secretLayer));

      topLayer.addTo(map);
      secretLayer.addTo(map);

      L.control.layers(null, { 'Top pla≈ºe (klasyki)': topLayer, 'Sekretne/ukryte pla≈ºe': secretLayer }, { collapsed: false }).addTo(map);

      const allCoords = [...TOP_BEACHES, ...SECRET_BEACHES].map(b => b.coords);
      const bounds = L.latLngBounds(allCoords);
      map.fitBounds(bounds, { padding: [30, 30] });

      // Proste testy w konsoli
      console.assert(map instanceof L.Map, 'Instancja mapy powinna byƒá L.Map');
      console.assert(topLayer.getLayers().length === TOP_BEACHES.length, 'Warstwa top powinna mieƒá wszystkie znaczniki');
      console.assert(secretLayer.getLayers().length === SECRET_BEACHES.length, 'Warstwa secret powinna mieƒá wszystkie znaczniki');
      console.log('Mapa gotowa ‚úîÔ∏è');
    } catch (err) {
      console.error('B≈ÇƒÖd inicjalizacji mapy:', err);
      const hint=document.createElement('div');
      hint.className='error-hint';
      hint.innerHTML='<b>Nie uda≈Ço siƒô zainicjowaƒá mapy.</b><br>Sprawd≈∫, czy przeglƒÖdarka nie blokuje skrypt√≥w z CDN (unpkg/jsDelivr/cdnjs).';
      document.body.appendChild(hint);
    }
  })();
  </script>
</body>
</html>
